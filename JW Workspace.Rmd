---
title: "JW Workspace"
author: "Justin Weltz"
date: "2/7/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
require(corrgram)
load("dat.Rdata")
```

Useful Functions
```{r}
colvar <- function(x){
  
  rowSums((x - rowMeans(x))^2)/(dim(x)[2]-1)
}

find_colvar <- function(str){
  x <- dat99 %>% select(starts_with(str))
  colvar(x)
}
```

Extract Important Predictor Variables - Importance and Support (Variance)
```{r}
predictor_vars <- c("A12", "B15", "C20", "C22")
pred_data <- matrix(NA, dim(dat99)[1], length(predictor_vars))

for (i in 1:length(predictor_vars)){
  pred_data[,i]<- find_colvar(predictor_vars[i])
}
pred_data <- data.frame(pred_data)
names(pred_data) <- c("A12_var", "B15_var", "C20_var", "C22_var")
#View(pred_data)

#corrgram(pred_data)
```

Preliminary Logistic Regression of whether or not a student leaves comments on indicators of survey engagement
```{r}
data <- dat99 %>% mutate(new_comment = COMMENTS == 1)
comments<- as.numeric(data$new_comment)
model_data <-cbind(comments, pred_data)
model <- glm(data= model_data, comments~. , family = "binomial")
plot(model)
summary(model)
corrgram(model_data)
```
Expanded Predictor Class - Importance, Support, Like (Variance)
```{r}
predictor_vars <- c("A12", "B15", "C20", "C22", "B9", "B12", "G9")
pred_data <- matrix(NA, dim(dat99)[1], length(predictor_vars))

for (i in 1:length(predictor_vars)){
  pred_data[,i]<- find_colvar(predictor_vars[i])
}

final_pred_data <- data.frame(pred_data)
names(final_pred_data) <- c("A12_var", "B15_var", "C20_var", "C22_var", "B9_var", "B12_var", "G9_var")

corrgram(final_pred_data)

```


Analysis Part 2 on Comments
```{r}
model_data <-cbind(comments, final_pred_data)
model <- glm(data= model_data, comments~. , family = "binomial")
plot(model)
summary(model)
corrgram(model_data)
```


Extreme Values in B1 and B3?

Social Change Variables
```{r}
data<- data %>% mutate(change_alc_pol = as.numeric(B5 == 2 | B5 == 3) )
data<- data %>% mutate(min_drink_age = as.numeric(B13 != 5 ))
data<- data %>% mutate(agree_alc_pol = as.numeric(B4 == 3 | B4 == 4) )
data<- data %>% mutate(change_tob_pol = as.numeric(B16 != 4 & B17 != 4 & B17 != B16) )
```


Create Final Model Data Set
```{r}
final_model_data <- cbind(model_data, data[,457:460])
corrgram(final_model_data)
```


Model Gradient Variances as predictors of Social Change Variables
```{r}

#CHANGE ALC POLICY

# Importance Variables
model <- glm(data= final_model_data, change_alc_pol~ A12_var+  B15_var + C20_var + C22_var , family = "binomial")
summary(model)

#Importance and Like Variables
model <- glm(data= final_model_data, change_alc_pol~ A12_var+  B15_var + C20_var + C22_var + B9_var + B12_var + G9_var , family = "binomial")
summary(model)

#AGREE ALC POLICY

# Importance Variables
model <- glm(data= final_model_data, agree_alc_pol~ A12_var+  B15_var + C20_var + C22_var , family = "binomial")
summary(model)

#Importance and Like Variables
model <- glm(data= final_model_data, agree_alc_pol~ A12_var+  B15_var + C20_var + C22_var + B9_var + B12_var + G9_var , family = "binomial")
summary(model)


#MINIMUM DRINKING AGE

#Importance Variables
model <- glm(data= final_model_data, min_drink_age~ A12_var+  B15_var + C20_var + C22_var , family = "binomial")
summary(model)

#Importance and Like Variables
model <- glm(data= final_model_data, agree_alc_pol~ A12_var+  B15_var + C20_var + C22_var + B9_var + B12_var + G9_var , family = "binomial")
summary(model)


#CHANGE TOBACCO POLICY

#Importance Variables
model <- glm(data= final_model_data, change_tob_pol~ A12_var+  B15_var + C20_var + C22_var , family = "binomial")
summary(model)

#Importance and Like Variables
model <- glm(data= final_model_data, change_tob_pol~ A12_var+  B15_var + C20_var + C22_var + B9_var + B12_var + G9_var , family = "binomial")
summary(model)
```


Multicollinearity (maybe check some more)

```{r}
corrgram(final_pred_data)
summary(lm(data= final_pred_data, C22_var ~.))
```

Sparse PCA
```{r}
#install.packages("sparsepca")
require(sparsepca)
pca <- robspca(final_pred_data)
summary(pca)
```


Factor Model?